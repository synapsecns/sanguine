name: Explorer UI Deploy
on:
  push:
    branches: [master]
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  changes:
    name: Change Detection
    runs-on: ubuntu-latest
    outputs:
      folders: ${{ steps.filter_go.outputs.changes }}
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - uses: dorny/paths-filter@v2
        name: 'Check for Changes in each ui folder'
        id: filter_ui
        with:
          #  make sure to update run-goreleaser when adding a new package here
          filters: |
            explorer: 'packages/explorer-ui/**'

  deploy-explorer:
    needs: changes
    runs-on: ubuntu-latest
    if: ${{ contains( fromJSON(needs.changes.outputs.folders), 'explorer-ui') }}
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Deploy to Vercel Action
        uses: BetaHuhn/deploy-to-vercel-action@v1
        with:
          GITHUB_TOKEN: '${{ secrets.GITHUB_TOKEN }}'
          VERCEL_TOKEN: '${{ secrets.VERCEL_TOKEN }}'
          VERCEL_ORG_ID: '${{ secrets.VERCEL_ORG_ID }}'
          VERCEL_PROJECT_ID: '${{ secrets.VERCEL_PROJECT_ID }}'
          WORKING_DIRECTORY: 'packages/explorer-ui'
